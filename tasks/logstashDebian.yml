---
- apt_key:
    url: "https://artifacts.elastic.co/GPG-KEY-elasticsearch"
    state: present
  become_user: true

- apt_repository:
    repo: "deb https://artifacts.elastic.co/packages/5.x/apt stable main"
    state: present
    filename: 'elastic-5.x'
  become_user: true


- name : add group
  group:
    name: logstash
    state: present

- name: Add Logstash user to logstatsh group (Debian).
  user:
    name: logstash
    group: logstash
  become: true

- name: Check if Logstash is already installed.
  stat: path=/etc/init.d/logstash
  register: logstash_installed

- name: Update apt cache if repository just added.
  apt: update_cache=yes
  when: logstash_installed.stat.exists == false

- get_url:
    url: "https://artifacts.elastic.co/downloads/logstash/logstash-5.5.0.deb"
    dest: /opt
  become: true

- name: Install Logstash.
  apt: name=logstash state=present

- name: restart logstash
  service: name=logstash state=restarted
